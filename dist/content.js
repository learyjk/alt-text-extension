(()=>{var m=setInterval(function(){let a=document.querySelectorAll('[data-automation-id="overlay"]'),t=document.querySelector(".site-canvas")?.firstElementChild?.firstElementChild?.childNodes[1];a.length>=2&&t&&(p(a[1].parentNode),f(t),clearInterval(m))},250),f=a=>{let t=(o,c)=>{for(let r of o)if(console.log({mutation:r}),r.type==="childList"&&r.addedNodes.length>0){let e=r.addedNodes[0];e?.attributes?.getNamedItem("data-automation-id")&&e?.classList.contains("image-mini-settings")&&console.log("image mini settings")}};new MutationObserver(t).observe(a,{childList:!0,subtree:!0})},p=a=>{let t=(o,c)=>{for(let r of o)if(r.type==="childList"&&r.addedNodes.length>0){let e=r.addedNodes[0];e?.attributes?.getNamedItem("data-automation-id")&&e?.querySelector('[data-automation-id="asset-details-popover"]')&&g(e)}};new MutationObserver(t).observe(a,{childList:!0})},g=a=>{let t=a.querySelector('[data-automation-id="asset-details-popover"]'),n=t?.querySelector('[data-automation-id="panel_asset_alt"]');if(!n||!t)return;let o=b(t);!o||!o.querySelector("span")||(n.querySelector("textarea")?.parentNode?.append(o),o?.addEventListener("click",r=>{let e=n.querySelector("textarea");if(!e)return;let l=t.querySelector("a")?.href;if(!l)return;let d=l.toLowerCase().split(".").pop();try{if(d==="svg"){console.info("SVG not supported :("),e.value="SVG not supported :(";return}e.value="Please wait";let s=setInterval(()=>{e.value.length>=14?e.value="Please wait":e.value+="."},250);chrome.runtime.sendMessage({contentScriptQuery:"postData",data:JSON.stringify({imageUrl:l}),url:"https://web-bae.azurewebsites.net/api/GetDescription?code=i0uGk4397zccFQC3NesER15fkumKOVL4uCB34VZ1OnI_AzFuJiyetQ==&clientId=default"},i=>{if(clearInterval(s),e.value="",i){if(i.error){e.value=i.error.message;return}let u=i.description.captions[0].text;u.length<1?(console.info("No caption found :("),e.value="No caption found :("):e.value=u}else e.value="No response. Please wait 60 seconds and try again.";e.focus();var v=new Event("change",{bubbles:!0,cancelable:!1});e.dispatchEvent(v)})}catch(s){console.error("error: ",s),e.value=s.message}}))},b=a=>{let t=a?.querySelector(".delete-asset")?.cloneNode(!0);if(!t){console.log("error getting delete asset");return}let n=t.querySelector("span");if(!n){console.log("error getting text");return}n.innerHTML="A.I. Bae",n.style.marginLeft="4px";let o=t.querySelector("i");if(!o){console.log("error getting icon");return}return o.remove(),t.style.background="#F17144",t.style.position="absolute",t.style.left="0px",t.style.bottom="0px",t};})();
