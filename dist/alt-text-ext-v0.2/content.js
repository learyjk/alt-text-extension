(()=>{var c="data-automation-id",b=`[${c}="overlay"]`,C=".bem-ImageInput",N=`[${c}="multi-image-field-preview"]`,y="bem-Pane";var M="#F17144",g="https://web-bae.azurewebsites.net/api/GetDescription?code=i0uGk4397zccFQC3NesER15fkumKOVL4uCB34VZ1OnI_AzFuJiyetQ==&clientId=default",S=setInterval(function(){let o=document.querySelectorAll(b);o.length>=2&&(I(o[0].parentNode),h(o[1].parentNode),clearInterval(S))},250),I=o=>{let e=async(i,m)=>{for(let a of i)if(a.type==="childList"&&a.addedNodes.length>0){let t=a.addedNodes[0];t?.attributes?.getNamedItem(c)&&t?.classList.contains(y)&&t.querySelectorAll(C).forEach(l=>{console.log(l);let s=E(l),r,u;s||(r=A(l),u=T(l)),!(!r||!u)&&r.addEventListener("click",()=>{r.textContent="Wait";let f=setInterval(()=>{r.textContent.length<8?r.textContent+=".":r.textContent="Wait"},250);chrome.runtime.sendMessage({contentScriptQuery:"postData",data:JSON.stringify({imageUrl:u}),url:g},p=>{let v="";p.error?v=p.error.message:v=p.description.captions[0].text,console.log({caption:v}),L(v),clearInterval(f),r.textContent="Alt Text Copied to Clipboard!",setTimeout(()=>{r.textContent="A.I. Alt"},1e3)})})})}};new MutationObserver(e).observe(o,{childList:!0,subtree:!0})};function L(o){try{navigator.clipboard.writeText(o)}catch{console.warn("error copying to clipboard")}}function E(o){return!!(o?.firstChild).classList.contains("bem-FileInput")}var T=o=>{let e=o.querySelector("img");if(!e){console.warn("no image found");return}return e.src},A=o=>{let n=o.querySelector(`[${c}="variant-img-delete-button"]`)?.cloneNode(!0);if(!n?.firstChild||!n.firstChild?.firstChild){console.warn("error building single CMS field button"),console.log(o);return}return n.firstChild?.remove(),n.firstChild.textContent="A.I. Alt",n.style.backgroundColor=M,n.addEventListener("click",()=>console.log("clicked single CMS button")),o.querySelector(".bem-ImageInput_Controls")?.append(n),n},h=o=>{let e=(i,m)=>{for(let a of i)if(a.type==="childList"&&a.addedNodes.length>0){let t=a.addedNodes[0];t?.attributes?.getNamedItem("data-automation-id")&&t?.querySelector('[data-automation-id="asset-details-popover"]')&&x(t)}};new MutationObserver(e).observe(o,{childList:!0})},x=o=>{let e=o.querySelector(`[${c}="asset-details-popover"]`),n=e?.querySelector(`[${c}="panel_asset_alt"]`);if(!n||!e)return;let i=D(e);!i||!i.querySelector("span")||(n.querySelector("textarea")?.parentNode?.append(i),i?.addEventListener("click",a=>{let t=n.querySelector("textarea");if(!t)return;let d=e.querySelector("a")?.href;if(!d)return;let l=d.toLowerCase().split(".").pop();try{if(l==="svg"){console.info("SVG not supported :("),t.value="SVG not supported :(";return}t.value="Please wait";let s=setInterval(()=>{t.value.length>=14?t.value="Please wait":t.value+="."},250);chrome.runtime.sendMessage({contentScriptQuery:"postData",data:JSON.stringify({imageUrl:d}),url:g},r=>{if(clearInterval(s),t.value="",r){if(r.error){t.value=r.error.message;return}let f=r.description.captions[0].text;f.length<1?(console.info("No caption found :("),t.value="No caption found :("):t.value=f}else t.value="No response. Please wait 60 seconds and try again.";t.focus();var u=new Event("change",{bubbles:!0,cancelable:!1});t.dispatchEvent(u)})}catch(s){console.error("error: ",s),t.value=s.message}}))},D=o=>{let e=o?.querySelector(".delete-asset")?.cloneNode(!0);if(!e){console.log("error getting delete asset");return}let n=e.querySelector("span");if(!n){console.log("error getting text");return}n.innerHTML="A.I. Bae",n.style.marginLeft="4px";let i=e.querySelector("i");if(!i){console.log("error getting icon");return}return i.remove(),e.style.background="#F17144",e.style.position="absolute",e.style.left="0px",e.style.bottom="0px",e};})();
